require("../../common/manifest.js");
require("../../common/vendor.js");
global.webpackJsonp([1],{17:function(t,e,i){"use strict";var n=s(i(2)),a=s(i(18));function s(t){return t&&t.__esModule?t:{default:t}}Page((0,n.default)(a.default))},18:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(20),a=i.n(n),s=i(21),o=!1;var r=function(t){o||i(19)},u=i(1)(a.a,s.a,r,null,null);u.options.__file="..\\..\\..\\..\\中旭\\uni-app实战教程 - 《悦读》项目实战\\uniapp\\yuedu\\pages\\write\\write.vue",u.esModule&&Object.keys(u.esModule).some(function(t){return"default"!==t&&"__"!==t.substr(0,2)})&&console.error("named exports are not supported in *.vue files."),u.options.functional&&console.error("[vue-loader] write.vue: functional components are not supported with templates, they should use render functions."),e.default=u.exports},19:function(t,e){},20:function(t,e,i){"use strict";(function(t){var n,a;Object.defineProperty(e,"__esModule",{value:!0});var s=i(3);e.default={data:function(){return{title:"",artList:[],inputContent:"",needUploadImg:[],uploadIndex:0,caties:["点击选择"],currentCateIndex:0,catiesFromApi:[],sedCateIndex:0}},onLoad:function(){if(n=this,!(a=this.checkLogin("../write/write","2")))return!1;s.sign(n.apiServer),t.request({url:this.apiServer+"category&m=index",method:"GET",success:function(t){if("ok"==t.data.status){var e=t.data.data;for(var i in e)n.caties.push(e[i]);n.catiesFromApi=e}}})},onShow:function(){if(!(a=this.checkLogin("../write/write","2")))return!1;s.sign(n.apiServer)},methods:{cateChange:function(t){var e=t.detail.value;if(this.currentCateIndex=e,!(e<1)){var i=this.caties[e];for(var n in this.catiesFromApi)if(i==this.catiesFromApi[n]){this.sedCateIndex=n;break}}},submit:function(e){var i=e.detail.value.artText;i.length<1?t.showToast({title:"请输入内容",icon:"none"}):(this.artList.push({type:"text",content:i}),this.inputContent="")},deleteText:function(e){var i=e.currentTarget.dataset.index;t.showModal({content:"确定要删除吗",title:"提示",success:function(t){t.confirm&&n.artList.splice(i,1)}})},addImg:function(){t.chooseImage({count:1,sizeType:["compressed "],success:function(t){n.artList.push({type:"image",content:t.tempFilePaths[0]})}})},removeImg:function(e){var i=e.currentTarget.dataset.index;t.showModal({content:"确定要删除吗",title:"提示",success:function(t){t.confirm&&n.artList.splice(i,1)}})},submitNow:function(){if(this.title.length<1)t.showToast({title:"请输入标题",icon:"none"});else if(this.artList.length<1)t.showToast({title:"请填写文章内容",icon:"none"});else if(this.sedCateIndex<1)t.showToast({title:"请选择分类",icon:"none"});else{for(var e=0;e<this.artList.length;e++)"image"==this.artList[e].type&&this.needUploadImg.push({tmpurl:this.artList[e].content,indexID:e});this.uploadImg()}},uploadImg:function(){if(this.needUploadImg.length<1||this.uploadIndex>=this.needUploadImg.length){t.showLoading({title:"正在提交"});var e=t.getStorageSync("sign");t.request({url:this.apiServer+"art&m=add",method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:{title:n.title,content:JSON.stringify(n.artList),uid:a[0],random:a[1],cate:n.sedCateIndex,sign:e},success:function(e){"ok"==e.data.status?(t.showToast({title:"提交成功",icon:"none"}),n.artList=[],s.sign(n.apiServer),n.currentCateIndex=0,n.sedCateIndex=0,n.needUploadImg=[],n.title="",setTimeout(function(){t.switchTab({url:"../my/my"})},1e3)):t.showToast({title:e.data.data,icon:"none"})}})}else{t.showLoading({title:"上传图片"});t.uploadFile({url:n.apiServer+"uploadimg",filePath:n.needUploadImg[n.uploadIndex].tmpurl,name:"file",success:function(e){if(console.log(e),"ok"!=(e=JSON.parse(e.data)).status)return t.showToast({title:"上传图片失败,请重试!",icon:"none"}),!1;var i=n.needUploadImg[n.uploadIndex].indexID;n.artList[i].content=n.staticServer+e.data,n.uploadIndex++,setTimeout(function(){n.uploadImg()},1e3)}})}}}}}).call(e,i(0).default)},21:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("view",{staticClass:"wrap"},[i("view",{staticClass:"write_title"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"title"}],attrs:{type:"text",placeholder:"请输入标题",eventid:"jrM-0"},domProps:{value:t.title},on:{input:function(e){e.target.composing||(t.title=e.target.value)}}})]),i("view",{staticClass:"artList"},t._l(t.artList,function(e,n){return i("block",{key:n},["image"==e.type?i("view",{staticClass:"item"},[i("image",{attrs:{src:e.content,"data-index":n,mode:"widthFix",eventid:"YMR-1-"+n},on:{tap:t.removeImg}})]):t._e(),"text"==e.type?i("view",{staticClass:"item"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.artList[n].content,expression:"artList[index].content"}],attrs:{value:e.content,placeholder:"",eventid:"ks9-2-"+n},domProps:{value:t.artList[n].content},on:{input:function(e){e.target.composing||(t.artList[n].content=e.target.value)}}}),i("view",{staticClass:"deleteText",attrs:{"data-index":n,eventid:"HJJ-3-"+n},on:{tap:t.deleteText}},[t._v("删除")])]):t._e(),t._v(".\n\t\t")])})),i("form",{attrs:{eventid:"IHj-6"},on:{submit:t.submit}},[i("view",{staticClass:"inputArea"},[i("view",{staticClass:"addImg",attrs:{eventid:"86M-4"},on:{tap:t.addImg}},[t._v("+图片")]),i("view",{staticClass:"addText"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.inputContent,expression:"inputContent"}],attrs:{name:"artText",maxlength:"-1",placeholder:"请输入文本",eventid:"0gN-5"},domProps:{value:t.inputContent},on:{input:function(e){e.target.composing||(t.inputContent=e.target.value)}}}),i("button",{attrs:{type:"primary","form-type":"submit"}},[t._v("添加")])],1)])]),i("view",{staticClass:"art-cate"},[i("view",[t._v("文章分类")]),i("view",{},[i("picker",{attrs:{mode:"selector",range:t.caties,eventid:"HCK-7"},on:{change:t.cateChange}},[i("view",[t._v(t._s(t.caties[t.currentCateIndex]))])])],1)]),t.artList.length>0?i("view",{staticClass:"submitNow",attrs:{eventid:"3rg-8"},on:{tap:t.submitNow}},[t._v("发布")]):t._e()],1)};n._withStripped=!0;var a={render:n,staticRenderFns:[]};e.a=a}},[17]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/write/write.js.map