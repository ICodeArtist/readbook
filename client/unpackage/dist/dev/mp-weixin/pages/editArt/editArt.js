require("../../common/manifest.js");
require("../../common/vendor.js");
global.webpackJsonp([6],{36:function(t,e,a){"use strict";var i=s(a(2)),n=s(a(37));function s(t){return t&&t.__esModule?t:{default:t}}Page((0,i.default)(n.default))},37:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(39),n=a.n(i),s=a(40),o=!1;var r=function(t){o||a(38)},c=a(1)(n.a,s.a,r,null,null);c.options.__file="..\\..\\..\\..\\A\\my\\readbook\\client\\pages\\editArt\\editArt.vue",c.esModule&&Object.keys(c.esModule).some(function(t){return"default"!==t&&"__"!==t.substr(0,2)})&&console.error("named exports are not supported in *.vue files."),c.options.functional&&console.error("[vue-loader] editArt.vue: functional components are not supported with templates, they should use render functions."),e.default=c.exports},38:function(t,e){},39:function(t,e,a){"use strict";(function(t){var i,n,s;Object.defineProperty(e,"__esModule",{value:!0});var o=a(3);e.default={data:function(){return{title:"",artList:[],inputContent:"",needUploadImg:[],uploadIndex:0,caties:["点击选择"],currentCateIndex:0,catiesFromApi:[],sedCateIndex:0}},onLoad:function(e){var a=this;if(n=this,i=e.artId,o.sign(this.apiServer),!(s=this.checkLogin("../my/my","2")))return!1;t.request({url:this.apiServer+"art&m=info&artid="+i,method:"GET",data:{},success:function(e){var i=e.data.data,s=i.art_content;s=JSON.parse(s),n.artList=s,a.title=i.art_title,t.request({url:n.apiServer+"category&m=index",method:"GET",success:function(t){var e=t.data.data;for(var a in e)n.caties.push(e[a]);n.catiesFromApi=e,n.sedCateIndex=i.art_cate;for(var s=e[i.art_cate],o=0;o<n.caties.length;o++)if(s==n.caties[o]){n.currentCateIndex=o;break}}})}})},methods:{submitNow:function(){if(this.title.length<2)t.showToast({title:"请输入标题",icon:"none"});else if(this.artList.length<1)t.showToast({title:"请填写文章内容",icon:"none"});else if(this.sedCateIndex<1)t.showToast({title:"请选择分类",icon:"none"});else{this.needUploadImg=[];for(var e=0;e<this.artList.length;e++)"image"==this.artList[e].type&&-1==this.artList[e].content.indexOf("www.orianna.top")&&this.needUploadImg.push({tmpurl:this.artList[e].content,indexID:e});this.uploadImg()}},uploadImg:function(){if(this.needUploadImg.length<1||this.uploadIndex>=this.needUploadImg.length){t.showLoading({title:"正在提交"});var e=t.getStorageSync("sign");t.request({url:this.apiServer+"art&m=edit&artid="+i,method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:{title:n.title,content:JSON.stringify(n.artList),uid:s[0],random:s[1],cate:n.sedCateIndex,sign:e},success:function(e){"ok"==e.data.status?(t.showToast({title:"提交成功",icon:"none"}),setTimeout(function(){t.switchTab({url:"../my/my"})},1e3)):t.showToast({title:e.data.data,icon:"none"})}})}else{t.showLoading({title:"上传图片"});t.uploadFile({url:n.apiServer+"uploadimg",filePath:n.needUploadImg[n.uploadIndex].tmpurl,name:"file",success:function(e){if("ok"!=(e=JSON.parse(e.data)).status)return console.log(e),t.showToast({title:"上传图片失败,请重试!",icon:"none"}),!1;var a=n.needUploadImg[n.uploadIndex].indexID;n.artList[a].content=n.staticServer+e.data,console.log(n.artList),n.uploadIndex++,setTimeout(function(){n.uploadImg()},1e3)},fail:function(){t.showToast({title:"上传图片失败,请重试!",icon:"none"})}})}},cateChange:function(t){var e=t.detail.value;if(this.currentCateIndex=e,!(e<1)){for(var a=this.caties[e],i=0;i<this.catiesFromApi.length;i++)if(a==this.catiesFromApi[i].cate_name){this.sedCateIndex=this.catiesFromApi[i].cate_id;break}this.currentCateIndex=e,console.log(this.sedCateIndex)}},removeImg:function(e){var a=e.currentTarget.dataset.index;t.showModal({content:"确定要删除此图片吗",title:"提示",success:function(t){t.confirm&&n.artList.splice(a,1)}})},deleteText:function(e){var a=e.currentTarget.dataset.index;t.showModal({content:"确定要删除吗",title:"提示",success:function(t){t.confirm&&n.artList.splice(a,1)}})},submit:function(e){var a=e.detail.value.artText;a.length<1?t.showToast({title:"请输入内容",icon:"none"}):(this.artList.push({type:"text",content:a}),this.inputContent="")},addImg:function(){t.chooseImage({count:1,sizeType:["compressed"],success:function(t){n.artList.push({type:"image",content:t.tempFilePaths[0]})}})}}}}).call(e,a(0).default)},40:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("view",{staticClass:"wrap"},[a("view",{staticClass:"write_title"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"title"}],attrs:{type:"text",placeholder:"请输入标题",eventid:"GAS-0"},domProps:{value:t.title},on:{input:function(e){e.target.composing||(t.title=e.target.value)}}})]),a("view",{staticClass:"artList"},t._l(t.artList,function(e,i){return a("block",{key:i},["image"==e.type?a("view",{staticClass:"item"},[a("image",{attrs:{src:e.content,"data-index":i,mode:"widthFix",eventid:"nA6-1-"+i},on:{tap:t.removeImg}})]):t._e(),"text"==e.type?a("view",{staticClass:"item"},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.artList[i].content,expression:"artList[index].content"}],attrs:{value:e.content,placeholder:"",eventid:"jq9-2-"+i},domProps:{value:t.artList[i].content},on:{input:function(e){e.target.composing||(t.artList[i].content=e.target.value)}}}),a("view",{staticClass:"deleteText",attrs:{"data-index":i,eventid:"c00-3-"+i},on:{tap:t.deleteText}},[t._v("删除")])]):t._e()])})),a("form",{attrs:{eventid:"36B-6"},on:{submit:t.submit}},[a("view",{staticClass:"inputArea"},[a("view",{staticClass:"addImg",attrs:{eventid:"LSZ-4"},on:{tap:t.addImg}},[t._v("+图片")]),a("view",{staticClass:"addText"},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.inputContent,expression:"inputContent"}],attrs:{name:"artText",maxlength:"-1",placeholder:"请输入文本",eventid:"LBZ-5"},domProps:{value:t.inputContent},on:{input:function(e){e.target.composing||(t.inputContent=e.target.value)}}}),a("button",{attrs:{type:"primary","form-type":"submit"}},[t._v("添加")])],1)])]),a("view",{staticClass:"art-cate"},[a("view",[t._v("文章分类")]),a("view",{},[a("picker",{attrs:{mode:"selector",range:t.caties,eventid:"NBm-7"},on:{change:t.cateChange}},[a("view",[t._v(t._s(t.caties[t.currentCateIndex]))])])],1)]),t.artList.length>0?a("view",{staticClass:"submitNow",attrs:{eventid:"A8k-8"},on:{tap:t.submitNow}},[t._v("编辑")]):t._e()],1)};i._withStripped=!0;var n={render:i,staticRenderFns:[]};e.a=n}},[36]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/editArt/editArt.js.map