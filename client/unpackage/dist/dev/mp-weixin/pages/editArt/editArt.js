require("../../common/manifest.js");
require("../../common/vendor.js");
global.webpackJsonp([6],{32:function(t,e,a){"use strict";var n=s(a(2)),i=s(a(33));function s(t){return t&&t.__esModule?t:{default:t}}Page((0,n.default)(i.default))},33:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a(35),i=a.n(n),s=a(36),o=!1;var r=function(t){o||a(34)},c=a(1)(i.a,s.a,r,null,null);c.options.__file="..\\..\\..\\..\\中旭\\uni-app实战教程 - 《悦读》项目实战\\uniapp\\yuedu\\pages\\editArt\\editArt.vue",c.esModule&&Object.keys(c.esModule).some(function(t){return"default"!==t&&"__"!==t.substr(0,2)})&&console.error("named exports are not supported in *.vue files."),c.options.functional&&console.error("[vue-loader] editArt.vue: functional components are not supported with templates, they should use render functions."),e.default=c.exports},34:function(t,e){},35:function(t,e,a){"use strict";(function(t){var n,i,s;Object.defineProperty(e,"__esModule",{value:!0});var o=a(3);e.default={data:function(){return{title:"",artList:[],inputContent:"",needUploadImg:[],uploadIndex:0,caties:["点击选择"],currentCateIndex:0,catiesFromApi:[],sedCateIndex:0}},onLoad:function(e){var a=this;if(i=this,n=e.artId,o.sign(this.apiServer),!(s=this.checkLogin("../my/my","2")))return!1;t.request({url:this.apiServer+"art&m=info&artid="+n,method:"GET",data:{},success:function(e){var n=e.data.data,s=n.art_content;s=JSON.parse(s),i.artList=s,a.title=n.art_title,t.request({url:i.apiServer+"category&m=index",method:"GET",success:function(t){var e=t.data.data;for(var a in e)i.caties.push(e[a]);i.catiesFromApi=e,i.sedCateIndex=n.art_cate;for(var s=e[n.art_cate],o=0;o<i.caties.length;o++)if(s==i.caties[o]){i.currentCateIndex=o;break}}})}})},methods:{submitNow:function(){if(this.title.length<2)t.showToast({title:"请输入标题",icon:"none"});else if(this.artList.length<1)t.showToast({title:"请填写文章内容",icon:"none"});else if(this.sedCateIndex<1)t.showToast({title:"请选择分类",icon:"none"});else{this.needUploadImg=[];for(var e=0;e<this.artList.length;e++)"image"==this.artList[e].type&&-1==this.artList[e].content.indexOf("www.orianna.top")&&this.needUploadImg.push({tmpurl:this.artList[e].content,indexID:e});this.uploadImg()}},uploadImg:function(){if(this.needUploadImg.length<1||this.uploadIndex>=this.needUploadImg.length){t.showLoading({title:"正在提交"});var e=t.getStorageSync("sign");t.request({url:this.apiServer+"art&m=edit&artid="+n,method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:{title:i.title,content:JSON.stringify(i.artList),uid:s[0],random:s[1],cate:i.sedCateIndex,sign:e},success:function(e){"ok"==e.data.status?(t.showToast({title:"提交成功",icon:"none"}),setTimeout(function(){t.switchTab({url:"../my/my"})},1e3)):t.showToast({title:e.data.data,icon:"none"})}})}else{t.showLoading({title:"上传图片"});t.uploadFile({url:i.apiServer+"uploadimg",filePath:i.needUploadImg[i.uploadIndex].tmpurl,name:"file",success:function(e){if("ok"!=(e=JSON.parse(e.data)).status)return console.log(e),t.showToast({title:"上传图片失败,请重试!",icon:"none"}),!1;var a=i.needUploadImg[i.uploadIndex].indexID;i.artList[a].content=i.staticServer+e.data,console.log(i.artList),i.uploadIndex++,setTimeout(function(){i.uploadImg()},1e3)},fail:function(){t.showToast({title:"上传图片失败,请重试!",icon:"none"})}})}},cateChange:function(t){var e=t.detail.value;if(this.currentCateIndex=e,!(e<1)){for(var a=this.caties[e],n=0;n<this.catiesFromApi.length;n++)if(a==this.catiesFromApi[n].cate_name){this.sedCateIndex=this.catiesFromApi[n].cate_id;break}this.currentCateIndex=e,console.log(this.sedCateIndex)}},removeImg:function(e){var a=e.currentTarget.dataset.index;t.showModal({content:"确定要删除此图片吗",title:"提示",success:function(t){t.confirm&&i.artList.splice(a,1)}})},deleteText:function(e){var a=e.currentTarget.dataset.index;t.showModal({content:"确定要删除吗",title:"提示",success:function(t){t.confirm&&i.artList.splice(a,1)}})},submit:function(e){var a=e.detail.value.artText;a.length<1?t.showToast({title:"请输入内容",icon:"none"}):(this.artList.push({type:"text",content:a}),this.inputContent="")},addImg:function(){t.chooseImage({count:1,sizeType:["compressed"],success:function(t){i.artList.push({type:"image",content:t.tempFilePaths[0]})}})}}}}).call(e,a(0).default)},36:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("view",{staticClass:"wrap"},[a("view",{staticClass:"write_title"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"title"}],attrs:{type:"text",placeholder:"请输入标题",eventid:"r4x-0"},domProps:{value:t.title},on:{input:function(e){e.target.composing||(t.title=e.target.value)}}})]),a("view",{staticClass:"artList"},t._l(t.artList,function(e,n){return a("block",{key:n},["image"==e.type?a("view",{staticClass:"item"},[a("image",{attrs:{src:e.content,"data-index":n,mode:"widthFix",eventid:"nN4-1-"+n},on:{tap:t.removeImg}})]):t._e(),"text"==e.type?a("view",{staticClass:"item"},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.artList[n].content,expression:"artList[index].content"}],attrs:{value:e.content,placeholder:"",eventid:"FzE-2-"+n},domProps:{value:t.artList[n].content},on:{input:function(e){e.target.composing||(t.artList[n].content=e.target.value)}}}),a("view",{staticClass:"deleteText",attrs:{"data-index":n,eventid:"3Uk-3-"+n},on:{tap:t.deleteText}},[t._v("删除")])]):t._e()])})),a("form",{attrs:{eventid:"S9p-6"},on:{submit:t.submit}},[a("view",{staticClass:"inputArea"},[a("view",{staticClass:"addImg",attrs:{eventid:"LIf-4"},on:{tap:t.addImg}},[t._v("+图片")]),a("view",{staticClass:"addText"},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.inputContent,expression:"inputContent"}],attrs:{name:"artText",maxlength:"-1",placeholder:"请输入文本",eventid:"n4n-5"},domProps:{value:t.inputContent},on:{input:function(e){e.target.composing||(t.inputContent=e.target.value)}}}),a("button",{attrs:{type:"primary","form-type":"submit"}},[t._v("添加")])],1)])]),a("view",{staticClass:"art-cate"},[a("view",[t._v("文章分类")]),a("view",{},[a("picker",{attrs:{mode:"selector",range:t.caties,eventid:"DrW-7"},on:{change:t.cateChange}},[a("view",[t._v(t._s(t.caties[t.currentCateIndex]))])])],1)]),t.artList.length>0?a("view",{staticClass:"submitNow",attrs:{eventid:"T93-8"},on:{tap:t.submitNow}},[t._v("编辑")]):t._e()],1)};n._withStripped=!0;var i={render:n,staticRenderFns:[]};e.a=i}},[32]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/editArt/editArt.js.map